<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>ZenZone - AI Therapy Companion</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Your safe space for mental health support and guidance">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #e8f2ff 50%, #f8faff 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.8) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 119, 198, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .chat-container {
            width: 100%;
            max-width: 900px;
            height: 700px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .chat-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 24px;
            text-align: center;
            position: relative;
            border-radius: 24px 24px 0 0;
            overflow: hidden;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            50% { transform: translate(-50%, -50%) rotate(180deg); }
        }

        .status-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 12px;
            height: 12px;
            background: #4CAF50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-indicator.disconnected {
            background: #f44336;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            position: relative;
            z-index: 2;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: logoGlow 3s ease-in-out infinite;
        }

        @keyframes logoGlow {
            0%, 100% { 
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 0 rgba(255, 255, 255, 0.4);
            }
            50% { 
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 0 0 20px 10px rgba(255, 255, 255, 0.2);
            }
        }

        .logo-icon svg {
            width: 32px;
            height: 32px;
            fill: white;
        }

        .header-content h1 {
            font-size: 36px;
            font-weight: 300;
            margin: 0;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 2;
        }

        .header-content p {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 400;
            margin: 0;
            position: relative;
            z-index: 2;
        }

        .connection-status {
            font-size: 12px;
            margin-top: 8px;
            opacity: 0.8;
        }

        .chat-messages {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 16px 20px;
            border-radius: 20px;
            word-wrap: break-word;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .message.bot .message-content {
            background: white;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 6px;
            margin-left: 12px;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-bottom-right-radius: 6px;
            margin-right: 12px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: #e2e8f0;
            color: #64748b;
        }

        .message-text {
            font-size: 15px;
            line-height: 1.5;
            margin-bottom: 4px;
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            margin-bottom: 20px;
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            margin-left: 12px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #94a3b8;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .chat-input-container {
            padding: 24px;
            background: white;
            border-top: 1px solid #e2e8f0;
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .chat-input:focus {
            border-color: #4facfe;
            background: white;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .send-button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(79, 172, 254, 0.4);
        }

        .send-button:active {
            transform: scale(0.95);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .welcome-message {
            text-align: center;
            color: #64748b;
            font-style: italic;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
        }

        /* Scrollbar styling */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                border-radius: 0;
                max-width: 100%;
            }

            .chat-header {
                border-radius: 0;
                padding: 20px;
            }

            .message-content {
                max-width: 85%;
            }

            .logo-container {
                margin-bottom: 12px;
            }

            .logo-icon {
                width: 50px;
                height: 50px;
                margin-right: 12px;
            }

            .logo-icon svg {
                width: 28px;
                height: 28px;
            }

            .header-content h1 {
                font-size: 28px;
            }

            .header-content p {
                font-size: 14px;
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- Header -->
        <div class="chat-header">
            <div class="status-indicator" id="statusIndicator"></div>
            <div class="header-content">
                <div class="logo-container">
                    <div class="logo-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1" stroke="currentColor" stroke-width="1.5" opacity="0.5"/>
                        </svg>
                    </div>
                    <h1>ZenZone</h1>
                </div>
                <p>Your AI Therapy Companion</p>
                <div class="connection-status" id="connectionStatus">
                    Connecting to AI...
                </div>
            </div>
        </div>

        <!-- Messages -->
        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                Welcome to ZenZone! I'm here to provide a safe space for you to express your thoughts and feelings. How are you doing today?
            </div>
        </div>

        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typingIndicator">
            <div class="message-avatar">Z</div>
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>

        <!-- Input -->
        <div class="chat-input-container">
            <div class="input-wrapper">
                <input 
                    type="text" 
                    id="inputMessage" 
                    class="chat-input" 
                    placeholder="Share what's on your mind..." 
                    autocomplete="off"
                />
                <button id="sendBtn" class="send-button">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:8000';
        
        // DOM Elements
        const chatMessages = document.getElementById('chatMessages');
        const inputMessage = document.getElementById('inputMessage');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const statusIndicator = document.getElementById('statusIndicator');
        const connectionStatus = document.getElementById('connectionStatus');

        // State
        let isConnected = false;
        let messageCount = 0;

        // Fallback therapy responses
        const fallbackResponses = [
            "I hear you, and I want you to know that your feelings are valid. Can you tell me more about what's making you feel this way?",
            "It sounds like you're going through a challenging time. Remember, it's okay to not be okay sometimes. What would help you feel more supported right now?",
            "I appreciate you sharing that with me. It takes courage to open up about difficult emotions. How long have you been feeling this way?",
            "That sounds really difficult. Have you tried any coping strategies that have helped you in the past?",
            "I can sense that this is weighing heavily on you. What would you like to focus on today - processing these feelings or finding some relief?",
            "Thank you for trusting me with this. It's important to acknowledge these emotions rather than push them away. What do you think might be the next small step forward?",
            "I'm here with you in this moment. Sometimes just talking about what we're experiencing can help. What else would you like to share?",
            "Your openness is really admirable. It's clear this matters a lot to you. How can I best support you right now?",
            "I want you to know that you're not alone in this. Many people experience similar feelings. What would be most helpful for you today?",
            "I can hear the strength in your words, even when things feel difficult. What gives you hope or comfort during challenging times?"
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            testConnection();
            addWelcomeMessage();
        });

        // Test backend connection
        async function testConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: 'test connection' })
                });
                
                if (response.ok) {
                    isConnected = true;
                    statusIndicator.classList.remove('disconnected');
                    connectionStatus.textContent = 'Connected to AI';
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                console.error('Backend connection failed:', error);
                isConnected = false;
                statusIndicator.classList.add('disconnected');
                connectionStatus.textContent = 'Using offline mode';
            }
        }

        // Add welcome message
        function addWelcomeMessage() {
            setTimeout(() => {
                addMessage("Hello! I'm your AI therapy companion. I'm here to provide a safe space for you to express your thoughts and feelings. What's on your mind today?", false);
            }, 1000);
        }

        // Add message to chat
        function addMessage(text, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = isUser ? 'U' : 'Z';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            const messageText = document.createElement('div');
            messageText.className = 'message-text';
            messageText.textContent = text;
            
            const messageTime = document.createElement('div');
            messageTime.className = 'message-time';
            messageTime.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageContent.appendChild(messageText);
            messageContent.appendChild(messageTime);
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Show typing indicator
        function showTypingIndicator() {
            typingIndicator.classList.add('show');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            typingIndicator.classList.remove('show');
        }

        // Get bot response
        async function getBotResponse(userMessage) {
            if (!isConnected) {
                // Use fallback responses
                return fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
            }

            try {
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: userMessage })
                });

                if (!response.ok) {
                    throw new Error('Failed to get response from backend');
                }

                const data = await response.json();
                return data.reply;
            } catch (error) {
                console.error('Error getting bot response:', error);
                return fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
            }
        }

        // Send message
        async function sendMessage() {
            const message = inputMessage.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, true);
            inputMessage.value = '';
            
            // Disable input
            inputMessage.disabled = true;
            sendBtn.disabled = true;
            
            // Show typing indicator
            showTypingIndicator();

            try {
                // Get bot response
                const botResponse = await getBotResponse(message);
                
                // Hide typing indicator
                hideTypingIndicator();
                
                // Add bot response
                addMessage(botResponse, false);
            } catch (error) {
                console.error('Error sending message:', error);
                hideTypingIndicator();
                addMessage("I'm sorry, I'm having trouble processing your message right now. Please try again.", false);
            } finally {
                // Re-enable input
                inputMessage.disabled = false;
                sendBtn.disabled = false;
                inputMessage.focus();
            }
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        
        inputMessage.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Focus input on load
        inputMessage.focus();
    </script>
</body>
</html>